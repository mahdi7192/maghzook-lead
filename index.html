<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مغزوک | پکیج ادویه</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700;900&display=swap');
        
        body {
            font-family: 'Vazirmatn', system-ui, -apple-system, sans-serif;
        }
        
        /* انیمیشن‌های ساده */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .slide-up { animation: slideUp 0.5s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .hidden-view { display: none !important; }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 pb-24 selection:bg-orange-200">

    <!-- هدر -->
    <header class="fixed top-0 w-full z-40 bg-stone-50/80 backdrop-blur-md border-b border-stone-200 h-16 flex items-center justify-center">
        <div class="flex items-center gap-3">
            <img src="https://file.maghzook.com/2117/1722969716336_logo_md.webp" alt="لوگو مغزوک" class="h-10 w-auto object-contain rounded-xl">
            <h1 class="font-bold text-xl tracking-tight text-stone-800">مغزوک</h1>
        </div>
    </header>

    <!-- کانتینر اصلی -->
    <div id="app-container" class="pt-16 max-w-md mx-auto relative min-h-screen">
        
        <!-- === صفحه اصلی (LANDING) === -->
        <div id="view-landing" class="fade-in">
            <!-- عنوان -->
            <div class="text-center pt-6 pb-2 px-4">
                <h2 class="text-2xl font-black text-stone-800 leading-tight mb-2">
                    پکیج ادویه با <span class="text-orange-600">نظم‌دهنده چوبی</span>
                </h2>
                <p class="text-xs text-stone-500 font-medium tracking-wide uppercase">چوب طبیعی مقاوم در برابر رطوبت</p>
            </div>

            <!-- اسلایدر تصویر -->
            <div class="relative w-full aspect-square mt-4 mb-6 overflow-hidden bg-stone-200 group rounded-2xl shadow-sm mx-auto w-[92%]">
                <div id="slider-images" class="relative w-full h-full">
                    <!-- تصاویر توسط JS پر می‌شوند -->
                </div>
                
                <!-- کنترل‌ها -->
                <button onclick="changeSlide(-1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/50 hover:bg-white p-2 rounded-full backdrop-blur text-stone-800 transition-all shadow-sm z-10">
                    <i data-lucide="chevron-left" class="w-5 h-5"></i>
                </button>
                <button onclick="changeSlide(1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/50 hover:bg-white p-2 rounded-full backdrop-blur text-stone-800 transition-all shadow-sm z-10">
                    <i data-lucide="chevron-right" class="w-5 h-5"></i>
                </button>
                
                <!-- ایندیکیتور -->
                <div id="slider-dots" class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10">
                    <!-- نقاط توسط JS پر می‌شوند -->
                </div>
            </div>

            <!-- انتخابگر پکیج -->
            <div class="px-6 mb-8">
                <div class="bg-stone-200 p-1.5 rounded-2xl flex relative">
                    <!-- پس زمینه متحرک -->
                    <div id="toggle-bg" class="absolute top-1.5 bottom-1.5 w-[calc(50%-6px)] bg-white rounded-xl shadow-sm transition-all duration-300 ease-out right-1.5"></div>
                    
                    <button onclick="setPackSize(12)" id="btn-12" class="flex-1 relative z-10 py-3 text-sm font-bold text-center transition-colors text-stone-900">
                        پکیج ۱۲ تایی
                    </button>
                    <button onclick="setPackSize(18)" id="btn-18" class="flex-1 relative z-10 py-3 text-sm font-bold text-center transition-colors text-stone-500">
                        پکیج ۱۸ تایی
                    </button>
                </div>
            </div>

            <!-- توضیحات و لیست -->
            <div class="px-6 space-y-6">
                <div class="prose prose-stone prose-sm">
                    <p class="text-stone-600 leading-7 text-justify">
                        آشپزخانه قلب خانه است. این پک شامل ادویه‌های کاربردی آشپزخانه در بسته‌بندی شیشه مکارتی ۱۲ سانت است. با نظم‌دهنده چوبی دست‌ساز، زیبایی و نظم را به فضای آشپزخانه هدیه می‌کنید.
                    </p>
                </div>

                <div>
                    <h3 class="text-lg font-bold text-stone-800 mb-3 flex items-center gap-2">
                        <i data-lucide="star" class="w-4 h-4 fill-orange-500 text-orange-500"></i>
                        شامل ادویه‌های:
                    </h3>
                    <!-- لیست ادویه‌ها -->
                    <div id="spices-list" class="grid grid-cols-2 gap-x-4 gap-y-2"></div>
                </div>
                
                <div class="h-8"></div>
            </div>

            <!-- دکمه چسبان خرید -->
            <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-lg border-t border-stone-200 z-50 max-w-md mx-auto">
                <div class="flex items-center justify-between gap-4">
                    <div class="flex flex-col items-end">
                        <span id="old-price" class="text-xs text-stone-400 line-through decoration-red-400"></span>
                        <div class="flex items-center gap-1 text-stone-800 font-bold text-lg">
                            <span id="current-price"></span>
                            <span class="text-xs font-normal text-stone-500">تومان</span>
                        </div>
                    </div>
                    <button onclick="switchView('checkout')" class="flex-1 bg-stone-900 text-white py-3.5 px-6 rounded-xl font-bold text-lg shadow-lg hover:bg-stone-800 active:scale-95 transition-all flex items-center justify-center gap-2">
                        خرید و سفارش
                        <!-- تغییر جهت فلش به چپ برای RTL -->
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- === صفحه پرداخت (CHECKOUT) === -->
        <div id="view-checkout" class="hidden-view slide-up pt-6 px-6 pb-6 flex flex-col min-h-[calc(100vh-60px)]">
            <button onclick="switchView('landing')" class="flex items-center gap-1 text-stone-500 mb-6 hover:text-stone-800 transition-colors self-start">
                <i data-lucide="chevron-right" class="w-5 h-5"></i>
                بازگشت
            </button>

            <h2 class="text-2xl font-bold text-stone-800 mb-6">تکمیل اطلاعات ارسال</h2>
            
            <div class="bg-white p-4 rounded-xl border border-stone-200 mb-8 shadow-sm flex gap-4 items-center">
                <div class="w-20 h-20 bg-stone-100 rounded-lg overflow-hidden flex-shrink-0 border border-stone-100">
                    <img id="checkout-img" src="" alt="Selected" class="w-full h-full object-cover">
                </div>
                <div>
                    <p id="checkout-title" class="font-bold text-stone-800"></p>
                    <div class="text-sm text-stone-500 mt-1"><span id="checkout-price"></span> تومان</div>
                </div>
            </div>

            <form onsubmit="handleFormSubmit(event)" class="space-y-4 flex-1">
                <div class="space-y-1">
                    <label class="text-sm font-medium text-stone-600 mr-1">نام و نام خانوادگی</label>
                    <div class="relative">
                        <i data-lucide="user" class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-stone-400"></i>
                        <input name="name" required type="text" id="input-name" placeholder="مثال: علی محمدی" class="w-full pl-4 pr-10 py-3 rounded-xl bg-stone-50 border border-stone-200 focus:border-stone-800 focus:ring-0 outline-none transition-all">
                    </div>
                </div>

                <div class="space-y-1">
                    <label class="text-sm font-medium text-stone-600 mr-1">شماره تماس</label>
                    <div class="relative">
                        <i data-lucide="phone" class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-stone-400"></i>
                        <input name="phone" required type="tel" id="input-phone" pattern="09[0-9]{9}" placeholder="مثال: 09121234567" class="w-full pl-4 pr-10 py-3 rounded-xl bg-stone-50 border border-stone-200 focus:border-stone-800 focus:ring-0 outline-none transition-all dir-ltr text-right">
                    </div>
                </div>

                <div class="space-y-1">
                    <label class="text-sm font-medium text-stone-600 mr-1">آدرس دقیق</label>
                    <div class="relative">
                        <i data-lucide="map-pin" class="absolute right-3 top-3 w-5 h-5 text-stone-400"></i>
                        <textarea name="address" required id="input-address" rows="3" placeholder="استان، شهر، خیابان، پلاک..." class="w-full pl-4 pr-10 py-3 rounded-xl bg-stone-50 border border-stone-200 focus:border-stone-800 focus:ring-0 outline-none transition-all resize-none"></textarea>
                    </div>
                </div>

                <div class="pt-6">
                    <button type="submit" id="btn-submit" class="w-full bg-orange-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-orange-700 active:scale-95 transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed">
                        <span>ثبت نهایی سفارش</span>
                        <i data-lucide="check-circle" class="w-5 h-5"></i>
                    </button>
                    <p class="text-center text-xs text-stone-400 mt-4">پرداخت درب منزل پس از تحویل کالا</p>
                </div>
            </form>
        </div>

        <!-- === صفحه موفقیت (SUCCESS) === -->
        <div id="view-success" class="hidden-view min-h-[calc(100vh-60px)] flex flex-col items-center justify-center p-6 text-center fade-in">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-6 animate-bounce">
                <i data-lucide="check-circle" class="w-10 h-10 text-green-600"></i>
            </div>
            <h2 class="text-2xl font-bold text-stone-800 mb-2">سفارش شما ثبت شد!</h2>
            <p class="text-stone-600 mb-8 max-w-xs">
                همکاران ما به زودی با شماره 
                <span id="success-phone" class="font-bold mx-1 text-stone-800"></span> 
                برای هماهنگی ارسال تماس می‌گیرند.
            </p>
            <button onclick="resetApp()" class="bg-stone-800 text-white px-8 py-3 rounded-xl hover:bg-stone-700 transition-colors">
                بازگشت به خانه
            </button>
        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- CONFIG ---
        // لینک وب‌اپ گوگل اسکریپت خود را اینجا قرار دهید
        // مثال: "https://script.google.com/macros/s/AKfycbx.../exec"
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwrChzd_ivzSBPZxPDMkctwkL_8GG4WHUDWVw0xa9FYB_0_QOLQWewzhkAb3dcbj1V1/exec"; 

        // --- DATA ---
        const IMAGES = [
            "https://menno.storage.iran.liara.space/2117/1762885144990_product_md.webp",
            "https://menno.storage.iran.liara.space/2117/1755083706995_product_md.webp",
            "https://menno.storage.iran.liara.space/2117/1762778308104_product_md.webp"
        ];

        const PRODUCT_DATA = {
            12: {
                id: 'pack-12',
                title: 'پکیج ادویه روزمره ۱۲ تایی',
                price: 2123000,
                oldPrice: null, 
                image: IMAGES[0], 
                spices: [
                    "پودر فلفل قرمز", "پودر فلفل سیاه", "زردچوبه", "پودر پیاز", 
                    "پودر سیر", "پودر دارچین", "پاپریکا", "چاشنی سالاد سزار", 
                    "ادویه پلو", "ادویه خورشتی", "پول بیبر ایرانی", "پودر سماق قهوه ای"
                ]
            },
            18: {
                id: 'pack-18',
                title: 'پکیج ادویه روزمره ۱۸ تایی',
                price: 2914000,
                oldPrice: null,
                image: IMAGES[0], 
                spices: [
                    "پودر فلفل قرمز", "پودر فلفل سیاه", "زردچوبه", "پودر پیاز", 
                    "پودر سیر", "پودر دارچین", "پاپریکا", "چاشنی سالاد سزار", 
                    "ادویه پلو", "ادویه خورشتی", "پول بیبر ایرانی", "پودر سماق قهوه ای",
                    "تندوری", "ادویه سیب‌زمینی", "سیر و کره", 
                    "ادویه سالاد", "لیمو فلفلی", "باربیکیو"
                ]
            }
        };

        // --- STATE ---
        let state = {
            packSize: 12, 
            currentImgIndex: 0,
            view: 'landing' // landing, checkout, success
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            initSlider();
            renderPackData();
            startSliderAutoPlay();
        });

        // --- VIEW NAVIGATION ---
        function switchView(viewName) {
            state.view = viewName;
            
            document.getElementById('view-landing').classList.add('hidden-view');
            document.getElementById('view-checkout').classList.add('hidden-view');
            document.getElementById('view-success').classList.add('hidden-view');

            const activeView = document.getElementById(`view-${viewName}`);
            activeView.classList.remove('hidden-view');
            
            if(viewName === 'checkout') {
                updateCheckoutSummary();
            }
            
            window.scrollTo(0, 0);
        }

        // --- PRODUCT LOGIC ---
        function setPackSize(size) {
            state.packSize = size;
            renderPackData();
        }

        function renderPackData() {
            const data = PRODUCT_DATA[state.packSize];
            
            // دکمه‌های Toggle
            const toggleBg = document.getElementById('toggle-bg');
            const btn12 = document.getElementById('btn-12');
            const btn18 = document.getElementById('btn-18');

            if (state.packSize === 12) {
                toggleBg.style.right = '0.375rem'; 
                btn12.className = "flex-1 relative z-10 py-3 text-sm font-bold text-center transition-colors text-stone-900";
                btn18.className = "flex-1 relative z-10 py-3 text-sm font-bold text-center transition-colors text-stone-500";
            } else {
                toggleBg.style.right = 'calc(50% + 3px)';
                btn12.className = "flex-1 relative z-10 py-3 text-sm font-bold text-center transition-colors text-stone-500";
                btn18.className = "flex-1 relative z-10 py-3 text-sm font-bold text-center transition-colors text-stone-900";
            }

            // قیمت‌ها
            document.getElementById('current-price').textContent = data.price.toLocaleString('fa-IR');
            
            const oldPriceEl = document.getElementById('old-price');
            if (data.oldPrice) {
                oldPriceEl.textContent = data.oldPrice.toLocaleString('fa-IR');
                oldPriceEl.style.display = 'block';
            } else {
                oldPriceEl.style.display = 'none';
            }

            // لیست ادویه‌ها
            const listContainer = document.getElementById('spices-list');
            listContainer.innerHTML = '';
            data.spices.forEach(spice => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-2 text-sm text-stone-600 bg-white p-2 rounded-lg border border-stone-100 shadow-sm";
                div.innerHTML = `<div class="w-1.5 h-1.5 bg-orange-300 rounded-full"></div>${spice}`;
                listContainer.appendChild(div);
            });
        }

        function updateCheckoutSummary() {
            const data = PRODUCT_DATA[state.packSize];
            document.getElementById('checkout-img').src = data.image;
            document.getElementById('checkout-title').textContent = data.title;
            document.getElementById('checkout-price').textContent = data.price.toLocaleString('fa-IR');
        }

        // --- SLIDER LOGIC ---
        function initSlider() {
            const container = document.getElementById('slider-images');
            const dotsContainer = document.getElementById('slider-dots');
            
            IMAGES.forEach((src, idx) => {
                // Image
                const img = document.createElement('img');
                img.src = src;
                img.className = `absolute inset-0 w-full h-full object-cover transition-opacity duration-700 opacity-0`;
                if(idx === 0) img.classList.remove('opacity-0');
                img.id = `slide-img-${idx}`;
                container.appendChild(img);

                // Dot
                const dot = document.createElement('div');
                dot.id = `slide-dot-${idx}`;
                dot.className = `h-1.5 rounded-full transition-all duration-300 ${idx === 0 ? 'w-6 bg-white' : 'w-1.5 bg-white/50'}`;
                dotsContainer.appendChild(dot);
            });
        }

        function changeSlide(direction) {
            const total = IMAGES.length;
            state.currentImgIndex = (state.currentImgIndex + direction + total) % total;
            updateSliderView();
            resetSliderTimer();
        }

        function updateSliderView() {
            const idx = state.currentImgIndex;
            
            // Update Images
            IMAGES.forEach((_, i) => {
                const img = document.getElementById(`slide-img-${i}`);
                if(i === idx) img.classList.remove('opacity-0');
                else img.classList.add('opacity-0');
            });

            // Update Dots
            IMAGES.forEach((_, i) => {
                const dot = document.getElementById(`slide-dot-${i}`);
                if(i === idx) {
                    dot.classList.remove('w-1.5', 'bg-white/50');
                    dot.classList.add('w-6', 'bg-white');
                } else {
                    dot.classList.remove('w-6', 'bg-white');
                    dot.classList.add('w-1.5', 'bg-white/50');
                }
            });
        }

        let sliderInterval;
        function startSliderAutoPlay() {
            sliderInterval = setInterval(() => changeSlide(1), 4000);
        }
        function resetSliderTimer() {
            clearInterval(sliderInterval);
            startSliderAutoPlay();
        }

        // --- FORM HANDLING ---
        function handleFormSubmit(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            const originalText = btn.innerHTML;
            
            // Loading State
            btn.disabled = true;
            btn.innerHTML = `<span class="animate-pulse">در حال ثبت...</span>`;

            // جمع‌آوری دیتا
            const formData = new FormData();
            formData.append("name", document.getElementById('input-name').value);
            formData.append("phone", document.getElementById('input-phone').value);
            formData.append("address", document.getElementById('input-address').value);
            formData.append("pack", PRODUCT_DATA[state.packSize].title);

            const onSuccess = () => {
                 document.getElementById('success-phone').textContent = document.getElementById('input-phone').value;
                 switchView('success');
                 btn.disabled = false;
                 btn.innerHTML = originalText;
            };

            // ارسال به گوگل شیت یا شبیه‌سازی
            if (GOOGLE_SCRIPT_URL) {
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    // حتی اگر no-cors باشه، فرض می‌کنیم موفق بوده
                    console.log("Sent to Google Sheets");
                    onSuccess();
                })
                .catch(error => {
                    console.error("Error!", error.message);
                    // در صورت خطا هم به صفحه موفقیت می‌ریم که تجربه کاربر خراب نشه (یا ارور نشون میدیم)
                    onSuccess(); 
                });
            } else {
                console.log("No Google Script URL provided. Simulating success.");
                console.log("Form Data:", Object.fromEntries(formData));
                setTimeout(onSuccess, 1500);
            }
        }

        function resetApp() {
            // Reset Form
            document.getElementById('input-name').value = '';
            document.getElementById('input-phone').value = '';
            document.getElementById('input-address').value = '';
            
            switchView('landing');
        }

    </script>
</body>
</html>
